<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Lab 1 Dashboard</title>
  <script type="module">
    import * as Plot from "https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6/+esm";

    async function loadPollinatorData() {
      // Load CSV locally
      const response = await fetch("./data/pollinator_activity_data.csv");
      const text = await response.text();

      // Parse CSV into objects
      const pollinator = text.split("\n").slice(1).map(line => {
        const [species, mass, span, flower, nectar, weather, visits] = line.split(",");
        return {
          pollinator_species: species,
          avg_body_mass_g: +mass,
          avg_wing_span_mm: +span,
          flower_species: flower,
          nectar_production: +nectar,
          weather_condition: weather,
          visit_count: +visits
        };
      });

      // #1 Body Mass vs Wing Span
      const chart1 = Plot.plot({
        title: "Body Mass vs Wing Span by Pollinator Species",
        height: 250,
        x: { label: "Average Body Mass (g)" },
        y: { label: "Average Wing Span (mm)" }, 
        color: { label: "Pollinator Species", legend: true },
        marks: [
          Plot.frame(),
          Plot.dot(pollinator, {
            x: "avg_body_mass_g",
            y: "avg_wing_span_mm",
            fill: "pollinator_species",
            r: 5
          })
        ]
      });
      document.body.appendChild(chart1);

      // #2 Average Visit Count by Weather Condition
      const chart2 = Plot.plot({
        title: "Average Visit Count by Weather Condition",
        height: 250,
        x: { label: "Weather Condition" },
        y: { label: "Average Visit Count" },
        marks: [
          Plot.frame(),
          Plot.barY(
            pollinator,
            Plot.groupX({ y: "mean" }, {
              x: "weather_condition",
              y: "visit_count",
              fill: "weather_condition"
            })
          )
        ]
      });
      document.body.appendChild(chart2);

      // #3 Average Nectar Production by Flower Species
      const chart3 = Plot.plot({
        title: "Average Nectar Production by Flower Species",
        height: 250,
        x: { label: "Average Nectar Production (Î¼L)" },
        y: { label: "Flower Species" },
        marginLeft: 90,
        marks: [
          Plot.frame(),
          Plot.barX(
            pollinator,
            Plot.groupY({ x: "mean" }, {
              x: "nectar_production",
              y: "flower_species",
              fill: "lightgreen"
            })
          )
        ]
      });
      document.body.appendChild(chart3);
    }

    loadPollinatorData();
  </script>
</head>
<body>
  <h2>LAB 1: Pollinators</h2>
  <p>This page is where you can iterate. Follow the lab instructions in the <a href="./README.md">readme.md</a>.</p>
</body>
</html>
